# 학생명부: 엑셀 업로드 + 자동 매핑 + 생년월일(PATCH)

- 날짜/시간: 2026-01-24 19:50:32
- 작업 폴더: `/Users/dev/onlyT_test1`

## 사용자 프롬프트

엑셀 업로드 학생관리 기능을 구현한다.

요구사항:

1. Excel(xlsx) 파일 업로드 API를 구현한다.
2. xlsx 라이브러리로 Excel을 JSON으로 변환한다.
3. 컬럼명이 문서마다 다르므로 의미 기반 자동 매핑을 수행한다.

컬럼 자동 매핑 후보:

- student_number:
  ["번호","순번","No","학생번호","순"]

- name:
  ["이름","성명","학생명","Name"]

- birth_date:
  ["생년월일","생년","출생일","출생일자","DOB","Birth","Birthday"]

- resident_id:
  ["주민등록번호","주민번호","RRN","ID Number"]

- address:
  ["주소","거주지","집주소","Address"]

4. 컬럼명은 소문자 변환 후 공백 및 특수문자 제거하고 fuzzy matching으로 매칭한다.
5. 주민등록번호가 있으면 앞 6자리에서 생년월일을 자동 추출한다.
6. 주민등록번호가 없으면 Excel 생년월일 컬럼을 birth_date로 저장한다.
7. 날짜 포맷은 YYYY-MM-DD로 통일한다.
8. 매칭 실패 컬럼은 무시하고 오류 메시지를 띄우지 않는다.
9. 결과 JSON 구조:

{
 student_number:"",
 name:"",
 birth_date:"",
 resident_id:"",
 address:""
}

10. 모든 학생 데이터를 bulk insert 한다.
11. 프론트 학생 테이블에 생년월일 컬럼을 date input으로 추가하고 수정 시 API PATCH 호출한다.

## AI 답변

- 백엔드
  - 업로드 API: 기존 `POST /student-records/upload-excel`(multipart) 경로를 사용.
  - `xlsx`로 시트를 2D 배열로 변환 후, 헤더 자동 탐지 + fuzzy matching으로 의미 기반 컬럼 매핑.
  - 주민번호가 있으면 주민번호에서 생년월일을 추출해 `YYYY-MM-DD`로 저장, 없으면 엑셀 생년월일을 ISO로 정규화해 저장.
  - 매칭 실패 컬럼은 무시(오류 메시지 없음).
  - 저장은 DB에 bulk upsert(실질적인 bulk insert 동작).
  - 생년월일 수정용 `PATCH /student-records/:id` API 추가.

- 프론트
  - `학생명부` 테이블에 `생년월일` 컬럼을 `type="date"`로 추가.
  - 생년월일 수정 시 `PATCH /student-records/:id` 호출.
  - 기존 bulk 저장 payload에도 `birthDate` 포함.
